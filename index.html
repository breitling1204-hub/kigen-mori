<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>期限の森 - Evolution</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans JP', sans-serif; background-color: #f0fdf4; margin: 0; padding: 0; }
        .gold-glow { filter: drop-shadow(0 0 10px rgba(251, 191, 36, 0.9)); color: #fbbf24 !important; }
        .floating { animation: float 3s infinite ease-in-out; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .tree-entry { animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
        /* 画面が重ならないように固定 */
        #app-container { min-height: 100vh; display: flex; flex-direction: column; }
    </style>
</head>
<body class="min-h-screen">

    <div id="app-container" class="max-w-md mx-auto p-6 pb-40">
        <!-- ヘッダー -->
        <header class="flex items-center justify-between mb-8">
            <div class="flex items-center gap-3">
                <div id="logo-bg" class="bg-emerald-600 p-2.5 rounded-2xl text-white shadow-lg transition-all">
                    <i class="fas fa-tree text-xl"></i>
                </div>
                <div>
                    <h1 class="font-black text-xl text-emerald-900 leading-none tracking-tighter">期限の森</h1>
                    <p id="status-text" class="text-[10px] font-black text-emerald-600 mt-1 uppercase tracking-[0.2em]">Standard Edition</p>
                </div>
            </div>
            <a href="https://buy.stripe.com/test_dRm3cxeri0dX8Hv1jb87K00" target="_blank" class="text-[10px] bg-amber-400 text-amber-900 px-4 py-2 rounded-full font-black shadow-md hover:scale-105 transition-transform">
                <i class="fas fa-crown"></i> PREMIUM
            </a>
        </header>

        <!-- 統計パネル（プレミアム会員のみ） -->
        <div id="premium-stats" class="hidden bg-emerald-900 text-white p-5 rounded-[2rem] shadow-xl mb-8 flex justify-around items-center">
            <div class="text-center">
                <p class="text-[9px] font-bold text-emerald-300 uppercase">森の密度</p>
                <p id="stat-count" class="text-xl font-black">0</p>
            </div>
            <div class="w-px h-8 bg-emerald-700"></div>
            <div class="text-center">
                <p class="text-[9px] font-bold text-emerald-300 uppercase">黄金率</p>
                <p id="stat-gold" class="text-xl font-black">0%</p>
            </div>
        </div>

        <!-- 入力フォーム -->
        <div class="bg-white p-6 rounded-[2.5rem] shadow-sm mb-8 border border-white">
            <div class="space-y-4">
                <div class="relative">
                    <i class="fas fa-tag absolute left-4 top-1/2 -translate-y-1/2 text-slate-300 text-sm"></i>
                    <input id="in-name" type="text" placeholder="食材の名前" class="w-full pl-11 pr-4 py-4 rounded-2xl bg-slate-50 border-none outline-none text-sm font-bold focus:ring-2 focus:ring-emerald-500">
                </div>
                <div class="relative">
                    <i class="fas fa-calendar absolute left-4 top-1/2 -translate-y-1/2 text-slate-300 text-sm"></i>
                    <input id="in-date" type="date" class="w-full pl-11 pr-4 py-4 rounded-2xl bg-slate-50 border-none outline-none text-sm font-bold focus:ring-2 focus:ring-emerald-500">
                </div>
                <button onclick="add()" class="w-full bg-emerald-600 text-white py-4 rounded-2xl font-black shadow-lg active:scale-95 transition-all text-sm uppercase tracking-widest">
                    新しい木を植える
                </button>
            </div>
        </div>

        <!-- リスト -->
        <div id="list" class="space-y-4">
            <!-- JavaScriptで描写 -->
        </div>
    </div>

    <!-- プレミアム体験ボタン -->
    <div class="fixed bottom-6 left-6 right-6 max-w-md mx-auto z-50">
        <button onclick="bePremium()" id="p-btn" class="w-full bg-slate-900 text-white py-4 rounded-2xl font-black text-[10px] shadow-2xl border border-slate-700 flex items-center justify-center gap-2">
            <i class="fas fa-sparkles text-amber-400"></i>
            <span>プレミアム会員特典を体験する</span>
        </button>
    </div>

    <script>
        // データの初期化
        let trees = JSON.parse(localStorage.getItem('my_trees_v2') || '[]');
        let mode = localStorage.getItem('my_mode_v2') || 'normal';

        function render() {
            const list = document.getElementById('list');
            const status = document.getElementById('status-text');
            const logo = document.getElementById('logo-bg');
            const pBtn = document.getElementById('p-btn');
            const stats = document.getElementById('premium-stats');

            // プレミアム表示の反映
            if (mode === 'premium') {
                status.innerText = "Premium Member";
                status.className = "text-[10px] font-black text-amber-600 mt-1 uppercase tracking-[0.2em]";
                logo.className = "bg-amber-500 p-2.5 rounded-2xl text-white shadow-lg";
                pBtn.innerHTML = '<i class="fas fa-undo"></i> <span>スタンダードに戻す</span>';
                stats.classList.remove('hidden');
                
                const goldCount = trees.filter(t => t.gold).length;
                document.getElementById('stat-count').innerText = trees.length;
                document.getElementById('stat-gold').innerText = trees.length ? Math.round((goldCount/trees.length)*100) + '%' : '0%';
            } else {
                status.innerText = "Standard Edition";
                status.className = "text-[10px] font-black text-emerald-600 mt-1 uppercase tracking-[0.2em]";
                logo.className = "bg-emerald-600 p-2.5 rounded-2xl text-white shadow-lg";
                pBtn.innerHTML = '<i class="fas fa-sparkles text-amber-400"></i> <span>プレミアム会員特典を体験する</span>';
                stats.classList.add('hidden');
            }

            if (trees.length === 0) {
                list.innerHTML = `
                    <div class="text-center py-16 opacity-20">
                        <i class="fas fa-seedling text-6xl mb-4"></i>
                        <p class="text-xs font-black uppercase tracking-widest">No Life in Forest</p>
                    </div>
                `;
                return;
            }

            // リストの生成
            list.innerHTML = trees.sort((a,b) => new Date(a.date) - new Date(b.date)).map(t => {
                const diff = Math.ceil((new Date(t.date) - new Date()) / (86400000));
                const expired = diff <= 0;
                
                let icon = t.gold ? "fa-tree" : (expired ? "fa-skull-crossbones" : (diff <= 3 ? "fa-leaf" : "fa-tree"));
                let colorClass = t.gold ? "gold-glow" : (expired ? "text-slate-300" : (diff <= 3 ? "text-amber-500" : "text-emerald-500"));
                
                return `
                    <div class="tree-entry bg-white p-5 rounded-[2rem] shadow-sm flex items-center gap-4 border border-white">
                        <div class="w-14 h-14 bg-slate-50 rounded-2xl flex items-center justify-center shadow-inner overflow-hidden">
                            <i class="fas ${icon} ${colorClass} text-2xl floating"></i>
                        </div>
                        <div class="flex-1">
                            <p class="font-black text-sm text-slate-800 leading-tight">${t.name}</p>
                            <div class="flex items-center gap-2 mt-2">
                                <span class="text-[9px] font-black uppercase px-2 py-0.5 rounded-full ${expired ? 'bg-slate-100 text-slate-400' : 'bg-emerald-50 text-emerald-600'}">
                                    ${expired ? 'Expired' : 'Days: ' + diff}
                                </span>
                                ${t.gold ? '<span class="text-[9px] font-black text-amber-500 bg-amber-50 px-2 py-0.5 rounded-full uppercase">Premium</span>' : ''}
                            </div>
                        </div>
                        <button onclick="del(${t.id})" class="text-slate-200 hover:text-red-400 p-2 transition-colors"><i class="fas fa-trash-alt"></i></button>
                    </div>
                `;
            }).join('');
        }

        function add() {
            const n = document.getElementById('in-name');
            const d = document.getElementById('in-date');
            if(!n.value || !d.value) return;
            
            trees.push({ 
                id: Date.now(), 
                name: n.value, 
                date: d.value, 
                gold: mode === 'premium' 
            });
            
            localStorage.setItem('my_trees_v2', JSON.stringify(trees));
            n.value = ''; d.value = '';
            render();
        }

        function del(id) {
            trees = trees.filter(t => t.id !== id);
            localStorage.setItem('my_trees_v2', JSON.stringify(trees));
            render();
        }

        function bePremium() {
            mode = (mode === 'normal') ? 'premium' : 'normal';
            localStorage.setItem('my_mode_v2', mode);
            render(); // リロードせずにそのまま切り替え
        }

        // 読み込み完了時に実行
        window.onload = render;
    </script>
</body>
</html>

